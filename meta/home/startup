#!/bin/sh

export CODEPATH=$HOME/app  #$HOME/share/infomachine2  # use ~/app for forwards-compatibility
echo ${CODEPATH}
cd ${CODEPATH}
echo "-------------------------------------"
echo "### DyNAMiC Workbench ###"
echo "### Working directory:"
pwd

export MONGOPATH=/usr/bin/mongod
export NODEPATH=$HOME/local/node/bin/node

echo "### Starting MongoDB (${MONGOPATH})"
${MONGOPATH} --logappend --logpath ${CODEPATH}/logs/mongod.log & 

echo "### Starting nodejs (${NODEPATH})"
${NODEPATH} --debug app.js

trap '{echo !!! Workbench error; exit}' ERR #; killall -2 background; exit}' ERR
trap '{echo "### Killing Mongod"; killall -2 background; echo "### Exiting Workbench"; exit}' SIGINT SIGTERM EXIT
#trap 'killall -2 background' SIGTERM
#trap 'killall -2 background' EXIT

