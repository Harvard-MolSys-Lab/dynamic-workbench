var path = require('path'), fs = require('fs'), utils = require('./utils');


if(process.argv.length < 3) {
	utils.log({level: 'error',message:'No module descriptor passed',source: 'server-tool-runner'});
	process.exit(1);
} else {
	var toolName = process.argv[2],
		toolArgs = process.argv.slice(3);
}

var toolClass = require(path.join('../server',toolName)),
	toolObject;

if(!toolClass) {
	utils.log({level: 'error',message:'No tool class defined in object',source: 'server-tool-runner'});
	process.exit(1);
} else {
	toolObject = new toolClass();
}

process.on('message',function(m,handle) {
	switch(m) {
		case 'start':
			toolObject.start.apply(toolObject,toolArgs);
			break;
		case 'exit':
			toolObject.exit();
			break;
		default: 
			toolObject.message(m);
	}
});

process.on('exit',function() {
	toolObject.exit();
})
