<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='App-ui-CreateMenu'>/**
</span> * Menu for creating a file; by default, allows the user to enter a filename and select among several file types.
 * 
 * This component supports several configuration modes. By default, clicking the #createButton will cause
 * the #createMenu to be shown. The #createMenu is generated by #getCreateMenu. The #createMenu will show
 * a list of file types; clicking on one of these file types will automatically append the appropriate 
 * extension, if the user hasn't added it already, then call #onCreate. By default, #onCreate creates a
 * new file by calling App.ui.filesTree#newFileUnderSelection. 
 * 
 * A custom action can be performed upon #createButton click by overriding #onCreateButton. Additionally,
 * the #autoCreateMenu config can be set to false to prevent a #createMenu from being generated at all, 
 * limiting user interaction to that specified by #onCreateButton.
 */
Ext.define('App.ui.CreateMenu', {
	extend: 'Ext.menu.Menu',
<span id='App-ui-CreateMenu-cfg-labelText'>	/**
</span>	 * @cfg
	 * Text to show ahead of the #fileNameField
	 */
	labelText: 'File Name:',
<span id='App-ui-CreateMenu-cfg-createText'>	/**
</span>	 * @cfg
	 * Text to show in the menu item (#createButton) which will show the menu of file types (the #createMenu)
	 */
	createText: 'Create',
<span id='App-ui-CreateMenu-cfg-createIconCls'>	/**
</span>	 * @cfg
	 * Icon class for the #createButton
	 */
	createIconCls: 'tick',

<span id='App-ui-CreateMenu-cfg-smartCreate'>	/**
</span>	 * @cfg
	 * True to create the file upon click of the #createButton (not #createMenu).
	 * This option does not apply if 
	 */
	smartCreate: false,
	defaultType: 'txt',

<span id='App-ui-CreateMenu-cfg-autoCreateMenu'>	/**
</span>	 * @cfg
	 * True to automatically build the file type menu by calling #getCreateMenu
	 */
	autoCreateMenu: true,
	
<span id='App-ui-CreateMenu-cfg-afterLeaveDelay'>	/**
</span>	 * @cfg
	 * Delay, in milliseconds, before this menu should be hidden after the mouse leaves.
	 */
	afterLeaveDelay: 500,
	
	mixins: {tip: 'App.ui.TipHelper'},
	
	initComponent: function() {
		this.extraMenuItems || (this.extraMenuItems = []);
		Ext.apply(this, {
			items: [{
				text: this.labelText,
				canActivate: false,
				iconCls: 'rename',
			},{
<span id='App-ui-CreateMenu-property-fileNameField'>				/**
</span>				 * @property {Ext.form.field.Text} fileNameField
				 */
				xtype: 'textfield',
				allowBlank: false,
				//validate: Ext.bind(this.validate,this),
				iconCls: 'rename',
				ref: 'fileNameField',
				indent: true,
<span id='App-ui-CreateMenu-cfg-extraMenuItems'>				/**
</span>				 * @cfg {Mixed[]} extraMenuItems
				 * An optional array of menu items to insert between the {@link #fileNameField} and the {@link #createButton}
				 */
			},].concat(this.extraMenuItems,[{
				text: this.createText,
				iconCls: this.createIconCls,
<span id='App-ui-CreateMenu-property-createButton'>				/**
</span>				 * @property {Ext.menu.Item} createButton
				 */
				ref: 'createButton',
				disabled: true,
				menu: Ext.apply(this.getCreateMenu(), {
					ref: 'createMenu',
				}),
			}])
		});
		this.callParent(arguments);
		
		// build tooltips
		this.mixins.tip.init.apply(this, arguments);
		
		// build references
		_.each(this.query('*[ref]'), function(cmp) {
			this[cmp.ref] = cmp;
		},this);
		
		// Disable the #createButton if the #fileNameField is marked invalid
		this.fileNameField.on('validitychange', function(field, isValid) {
			this.createButton.setDisabled(!isValid);
		},this);
		
		// On clicking the #createButton (the &quot;Create&quot; menu item), invoke #onCreateButton 
		this.createButton.on('click', function() {
			var name=this.fileNameField.getValue();
			this.onCreateButton(name);
		},this);
		
		// If a #createMenu was generated, call #onCreate when the user clicks on the #createMenu 
		if(this.createMenu) {
			this.createMenu.on('click', function(menu,item,e) {
				if(item) {
					var type = item.type, name=this.fileNameField.getValue(), fullName = (type!='folder') ? App.Path.addExt(name,type) : name;
					this.onCreate(type,name,fullName);
				}
			},this);
		}
	},
	afterRender : function() {
		this.callParent(arguments);
		// var me = this;
		// me.el.un(me.mouseMonitor)
		// me.mouseMonitor = me.el.monitorMouseLeave(this.afterLeaveDelay, me.onMouseLeave, me);
	},
	
<span id='App-ui-CreateMenu-method-onCreateButton'>	/**
</span>	 * Override to provide custom logic upon clicking the #createButton. By default, creates a file by
	 * calling #onCreate if the #smartCreate option is set. 
	 * @param {String} fileName The current value of the &quot;name&quot; field
	 */
	onCreateButton: function(fileName) {
		if(this.smartCreate) {
			var name = this.fileNameField.getValue(), 
				type = this.defaultType, 
				fullName = (type!='folder') ? App.Path.addExt(name,type) : name;
			this.onCreate(type,name,fullName);
		}
	},
<span id='App-ui-CreateMenu-method-onCreate'>	/**
</span>	 * Action to perform when the &quot;Create&quot; menu item is selected. By default, creates a new file under the selected item in
	 * the {@link App.ui.filesTree files tree} and opens the file.
	 */
	onCreate: function(type,name,fullName) {
		App.ui.filesTree.newFileUnderSelection(fullName,function(rec) {
			App.ui.filesTree.open(rec);
		});
	},
<span id='App-ui-CreateMenu-method-getCreateMenu'>	/**
</span>	 * Builds the menu of file types. Each child item in this menu should have a &lt;var&gt;type&lt;/var&gt; property referring to the
	 * type of resource to be created. 
	 * @returns {Mixed} config An {@link Ext.menu.Menu} or config object 
	 */
	getCreateMenu: function() {
		if(!this.autoCreateMenu) {
			return false;
		}
		var items = [{
				text: 'Nodal System',
				iconCls: 'nodal',
				type: 'nodal',
			},{
				text: 'DyNAML File',
				iconCls: 'dynaml',
				type: 'dynaml',
			},{
				text: 'DyNAMiC Intermediate (DIL)',
				iconCls: 'dil',
				type: 'dil',
			},'-',{
				text: 'Pepper System',
				iconCls: 'pepper',
				type: 'sys',
			},{
				text: 'Pepper Component',
				iconCls: 'comp',
				type: 'comp',
			},{
				text: 'Pepper Intermediate (PIL)',
				iconCls: 'pil',
				type: 'pil',
			},'-',{
				text: 'NUPACK Multi-objective script',
				iconCls: 'nupack',
				type: 'np',
			},{
				text: 'Sequence',
				iconCls: 'seq',
				type: 'seq',
			},{
				text: 'Primary Structure',
				iconCls: 'line',
				type: 'primary',
			},{
				text: 'Secondary Structure',
				iconCls: 'polyline',
				type: 'secondary',
			},'-',{
				text: 'Chemical Reaction Network',
				iconCls: 'crn',
				type: 'crn',
				disabled: true,
			},{
				text: 'SBML File',
				iconCls: 'document-sbml',
				type: 'sbml',
			},'-',{
				text: 'Workspace',
				iconCls: 'whiteboard',
				type: 'workspace',
			},{
				text: 'HTML File',
				iconCls: 'html',
				type: 'html',
			},{
				text: 'XML File',
				iconCls: 'xml',
				type: 'xml',
			},{
				text: 'Javascript File',
				iconCls: 'js',
				type: 'js',
			},{
				text: 'CoffeeScript File',
				iconCls: 'coffee',
				type: 'coffee',
			},{
				text: 'Text File',
				iconCls: 'txt',
				type: 'txt',
			},{
				text: 'LaTeX Document',
				iconCls: 'tex',
				type: 'tex',
			},{
				text: 'Markdown Document',
				iconCls: 'md',
				type: 'md',
			},'-',{
				text: 'Folder',
				iconCls: 'folder',
				type: 'folder'
			}]
		
		return {

			items: _.map(items,function(item) {
				if(_.isObject(item)) {
					item.tooltip = {
						title: App.Files.getTypeName(item.type),
						text: App.Files.getTypeDescription(item.type) || '&amp;nbsp;',
						trackMouse: false,
						anchor: 'right',
						anchorToTarget: true,
					}
				}
				return item;
			})
		};
	}
});</pre>
</body>
</html>
