<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">importScripts('lib/underscore.js','dd.js');

function permutations(length) {
	function permute(prev,alphabet) {
		var o = [];
		_.each(prev, function(item) {
			_.each(alphabet, function(ch) {
				o.push(item+ch);
			});
		});
		return o;
	}

	var out = ['A','T','C','G'], alph = ['A','T','C','G'];
	for(var i=1;i&lt;length;i++) {
		out = permute(out,alph);
	}
	return out;
}

function brute(strands,length) {

	var designer = new DD();
	nMers = permutations(length),
	nMerIndex = 0;
	designer.addDomains(strands);
	nMerIndex = designer.getDomainCount();

	return scores = _.reduce(nMers, function(memo,nMer) {
		designer.addDomains([nMer]);
		// true to force recalculation of scores
		memo[nMer] = designer.getScore(nMerIndex,true)
		designer.popDomain();
		return memo;
	}, {});

}

self.onmessage = function(e) {
	var x = brute(e.data.strands,e.data.length);
	self.postMessage(x);
};
</pre>
</body>
</html>
